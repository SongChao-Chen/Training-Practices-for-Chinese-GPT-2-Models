run GPT2 from https://github.com/lvfinn/chinese-GPT2-start-from-zero
==

1.Description:
---
这是一个训练GPT2练习，源代码为 https://github.com/lvfinn/chinese-GPT2-start-from-zero.

2.Start:
----
(1)***environment***

运行系统为Linux，首先，安装以下依赖：
```bash
pip install -r requirements.txt
```

(2)***dataset***

把自己准备好的中文语料放置在./data/文件夹下，将语料由.txt文件更改为input.json文件。本次使用的中文语料为《邪王追妻：废材逆天小姐》。
打开 /data 路径，执行下面的指令，生成符合训练规范的训练文本文件(tran.json)。
```bash
python clr_ctrl.py
```

(3)***Model***

为了能在8G内存大小的GPU下训练GPT2，我使用以下的参数定义。参数配置文件为 config/model_config_small.json

- "initializer_range": 0.02 ： 定义了模型参数（如权重矩阵）在初始化时的标准差，权重会在均值为0，标准差为0.02的正态分布中进行随机初始化。
- "layer_norm_epsilon": 1e-05 ： 用于层归一化的常数，用于避免在归一化过程中出现除以零的情况。设置值为1e-05，用于稳定训练。
- "n_ctx": 512 ： 表示模型上下文窗口的大小，GPT-2 在生成文本时会考虑的最大序列长度。最大长度设为1024，即模型一次最多能处理1024个 token。
- "n_embd": 768 ： 表示每个token的嵌入维度大小，即模型中词向量的维度。设置为768，即每个词汇的表示向量是768维的。
- "n_head": 12 ： 表示自注意力机制中的注意力头的数量。设置为12，即模型的多头注意力机制中有12个独立的头。
- "n_layer": 10 ： 表示 Transformer 编码器中的层数。在这里，设置为 12，即模型有 12 层堆叠的 Transformer 块。
- "n_positions": 1024 ： 表示模型可以处理的最大位置索引，即序列中的最大位置数。最大位置数为 1024，和 n_ctx一致，表示模型最多能处理1024个位置的token。
- "vocab_size": 13317 ： 表示词汇表的大小，即模型可以识别和生成的词汇数量。在这里，词汇表大小为 21128，表示该模型可以处理的词汇量为21128个不同的 token。


(4)***Training***

使用下面的指令训练GPT2：
```bash
python train.py   --model_config config/model_config_small.json   --tokenized_data_path data/tokenized/   --tokenizer_path cache/vocab_small.txt   --raw_data_path data/train.json   --epochs 15   --log_step 200   --stride 512   --output_dir model/   --device 0,1   --num_pieces 100   --raw
```

最终得到15个epochs的模型，将最终的模型与配置文件放置于：model/final_model

(5)***Generate***

生成结果：
```bash
python generate.py   --device 1   --length 1000   --tokenizer_path cache/vocab_small.txt   --model_path model/final_model   --prefix "[CLS]苏落妩媚一笑"   --topp 1   --temperature 1.0 --save_samples --save_samples_path ./mnt/
```

3.Result
--
生成了10个文字样本，存储在./mnt/目录下，其中之一为：

======================================== SAMPLE 1 ========================================

苏落妩媚一笑。此事到如今，苏落还有什么事要说呢？她要是再拒绝，她必定会拒绝他的。想至此，苏落一双黑白分明的漂亮眼眸定定的望着南宫珈怡，眸中水盈盈。但是，南宫流皓却如清水，深情似水，那么深邃的眼眸深沉似海中的一切清澈清澈深邃。她的落落，就算是南宫流云，那也是个女神的女神。南宫珈怡盯着苏落，眼底闪过一抹难以置信的惊喜！她不过是个女人，可不是她女神！苏落的心思很好，她还是清楚的，现在她情不好，她不会不好心的去吧？南宫珈怡的眼眸紧紧盯着屏幕。她知道，她是不是对自己好好反待的，所以她知道，当她看苏落时候，她的美貌已经清楚楚。苏落的美眸微微一闪，她盯着南宫流云：“你想干嘛？”南宫流云没好气的说：“我不问你。”苏落淡淡一笑：“不过，这样的事，如果你想的话，那就不好说了。”“什么？”南宫夫人瞪大眼睛！“你是怎么知道的？”南宫流云淡淡一笑，“如果我说的是事实，我是不信她了。”苏落微微蹙眉：“不是不是。”“不想。”南宫流云哼哼两声，“你不觉得。”“不想反悔。”苏落冷哼一声。不过也就罢了，不过她总觉的到，这样的南宫夫人应该不会对她下手。南宫流云却笑的轻松松松而得意。他说的没错，就是不信。不过，不管他怎么想都想不通。“那你们现在的身子，都不会有事，还会怎么样？”南宫夫人冷嗤一声，“如果是你们不明白，这事可真够直接掐灭我们的脖子的。”苏落眼角微微勾起：“如果不是我说的，不止你们两个反过来，你们都觉得这样的话还是不对，可是这样说，你们两个现在的身子却是怎样的不对劲的？”南宫夫人冷嗤一声：“如果我没猜错的话，那就是说，我们这样说，你们的身体会变得太好了？”苏落点点头：“不，不过，你们可不是完全不知道的。”

南宫珈怡的心头猛然间一跳，差点被她的手掐住。她不是说南宫流云对他说的对不起的，她会不会以为这样对她好吗？但是，这时候的苏落却微微摇摇头，她觉得自己不好说话。“那怎么办？”苏落一把推开南宫夫人。南宫夫人的眼神带了一丝疑惑，她不知道该怎么办，她不知道，苏落在想什么，她想说什么就做什么，却见苏落冷冷哼一声：“苏落，你来做我的腿！”苏落冷哼一声：“你去试试？”然而不得不说，南宫夫人不会想到，她的眼睛在黑暗中的手指上划过：“你不要的话，不要去。”苏落想到自己的心脏跳动了动。但是南宫夫人却冷笑一声：“不，不去了，不去了。”说着，南宫夫人就想走。但是南宫流云却冷笑一声，将苏落拉住她走近。苏落不知道南宫流云是在做什么呢

==========================================================================================
